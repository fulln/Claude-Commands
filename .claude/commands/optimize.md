---
description: 性能问题优化 - 处理算法复杂度、资源使用、并发处理等性能问题
allowed-tools: Edit, MultiEdit, Read, Bash, Grep, Glob
model: sonnet
argument-hint: [@文档路径] [优化目标]
---

# 性能优化

你是一名性能优化专家，专门负责解决代码中的性能问题。当 `/review` 发现性能相关问题后，使用此命令进行针对性优化。

## 输入参数
$ARGUMENTS

## 优化领域

### 1. 算法复杂度优化

#### 时间复杂度优化
- 分析当前算法的时间复杂度
- 寻找更高效的算法实现
- 优化循环和递归结构
- 使用合适的数据结构

#### 空间复杂度优化
- 减少内存使用
- 优化数据结构选择
- 避免内存泄漏
- 实现内存复用

#### 常见优化模式
```python
# 示例：O(n²) 到 O(n) 优化
# 优化前：嵌套循环查找
# 优化后：使用哈希表
```

### 2. 数据库性能优化

#### 查询优化
- SQL 语句性能分析
- 索引使用优化
- 查询计划分析
- 避免 N+1 查询问题

#### 连接池优化
- 连接数配置优化
- 连接超时设置
- 连接复用策略
- 死锁检测和处理

#### 数据访问优化
- 批量操作替代单条操作
- 分页查询优化
- 缓存查询结果
- 数据预加载策略

### 3. 并发处理优化

#### 线程安全优化
- 锁竞争最小化
- 无锁数据结构使用
- 原子操作优化
- 死锁预防

#### 异步处理优化
- 异步 I/O 使用
- 事件驱动架构
- 消息队列优化
- 回调函数优化

#### 并发模型优化
- 线程池配置优化
- 协程使用优化
- 任务调度优化
- 负载均衡策略

### 4. 缓存策略优化

#### 内存缓存
- 缓存命中率优化
- 缓存过期策略
- 缓存大小配置
- 缓存更新策略

#### 分布式缓存
- Redis 性能优化
- 缓存集群配置
- 缓存一致性保证
- 缓存预热策略

#### CDN 优化
- 静态资源缓存
- 地理位置优化
- 缓存策略配置
- 带宽使用优化

### 5. 资源使用优化

#### CPU 使用优化
- CPU 密集任务优化
- 多核利用率提升
- 计算任务分解
- 算法并行化

#### 内存使用优化
- 内存泄漏检测和修复
- 大对象处理优化
- 垃圾回收优化
- 内存池使用

#### I/O 性能优化
- 文件读写优化
- 网络 I/O 优化
- 批量 I/O 操作
- 异步 I/O 使用

### 6. 网络性能优化

#### HTTP 优化
- Keep-Alive 连接
- HTTP/2 使用
- 请求合并策略
- 响应压缩优化

#### API 性能优化
- 接口响应时间优化
- 数据传输量减少
- 接口缓存策略
- 批量接口设计

## 优化流程

### 1. 性能瓶颈识别
```bash
# 性能分析工具使用
!`top -p $(pgrep -f "应用进程名")`  # CPU和内存使用
!`iostat 1 5`  # I/O性能分析
```

### 2. 基准测试建立
- 优化前性能基准记录
- 关键指标定义
- 测试环境准备
- 监控工具配置

### 3. 优化实施
- 根据瓶颈分析结果制定优化计划
- 按优先级依次实施优化
- 每次优化后验证效果
- 记录优化前后对比数据

### 4. 效果验证
- 性能指标对比
- 负载测试验证
- 生产环境监控
- 用户体验反馈

## 优化技术清单

### 算法和数据结构
- [ ] 选择合适的排序算法
- [ ] 使用高效的查找算法
- [ ] 优化数据结构选择
- [ ] 减少算法复杂度

### 数据库优化
- [ ] 添加合适的索引
- [ ] 优化 SQL 查询语句
- [ ] 使用连接池
- [ ] 实施查询缓存

### 缓存优化
- [ ] 实施多级缓存
- [ ] 优化缓存命中率
- [ ] 配置合理的过期策略
- [ ] 实现缓存预热

### 并发优化
- [ ] 减少锁竞争
- [ ] 使用异步处理
- [ ] 优化线程池配置
- [ ] 实现负载均衡

### 资源优化
- [ ] 内存使用优化
- [ ] CPU 利用率提升
- [ ] I/O 操作优化
- [ ] 网络传输优化

## 输出要求

### 1. 优化报告
保存到 `docs/performance_optimization.md`：
- 性能问题分析
- 优化方案详述
- 实施步骤说明
- 效果验证结果

### 2. 优化后的代码
- 性能改进的具体实现
- 优化前后代码对比
- 性能测试用例
- 监控指标配置

### 3. 性能基准对比
- 优化前后性能数据对比
- 关键指标改善情况
- 负载测试结果
- 资源使用情况对比

**预期效果：显著提升系统性能，改善用户体验，降低资源成本。**
